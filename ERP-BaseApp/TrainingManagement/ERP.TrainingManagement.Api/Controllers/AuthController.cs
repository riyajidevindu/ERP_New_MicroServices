//using ERP.TrainingManagement.Core.DTOs.Requests;
//using ERP.TrainingManagement.Core.Entities;
//using Microsoft.AspNetCore.Http;
//using Microsoft.AspNetCore.Identity;
//using Microsoft.AspNetCore.Mvc;
//using Microsoft.EntityFrameworkCore;
//using Microsoft.IdentityModel.Tokens;
//using System.IdentityModel.Tokens.Jwt;
//using System.Security.Claims;
//using System.Text;

//namespace ERP.TrainingManagement.Api.Controllers
//{
//    [Route("api/[controller]")]
//    [ApiController]
//    public class AuthController : ControllerBase
//    {
//        private readonly UserManager<ApplicationUser> _userManager;
//        private readonly SignInManager<ApplicationUser> _signInManager;
//        private readonly IConfiguration _configuration;

//        public AuthController(UserManager<ApplicationUser> userManager, SignInManager<ApplicationUser> signInManager, IConfiguration configuration)
//        {
//            _userManager = userManager;
//            _signInManager = signInManager;
//            _configuration = configuration;
//        }

//        [HttpPost("login")]
//        public async Task<IActionResult> Login([FromBody] LoginRequest loginRequest)
//        {
//            if (!ModelState.IsValid)
//            {
//                return BadRequest(ModelState);
//            }
//            var normalizedEmail = loginRequest.Email.ToUpper();
//            var user = await _userManager.Users.SingleOrDefaultAsync(u => u.NormalizedUserName == normalizedEmail);
//            if (user == null)
//            {
//                return Unauthorized();
//            }

//            var result = await _signInManager.CheckPasswordSignInAsync(user, loginRequest.Password, false);
//            if (!result.Succeeded)
//            {
//                return Unauthorized();
//            }

//            var token = GenerateJwtToken(user);
//            return Ok(new LoginResponse { Token = token, Expiration = DateTime.UtcNow.AddHours(1) });
//        }

//        private string GenerateJwtToken(ApplicationUser user)
//        {
//            var roles = _userManager.GetRolesAsync(user).Result;
//            var claims = new List<Claim>
//    {
//        new Claim(JwtRegisteredClaimNames.Sub, user.Id.ToString()),
//        new Claim(JwtRegisteredClaimNames.Email, user.Email),
//        new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())
//    };

//            claims.AddRange(roles.Select(role => new Claim(ClaimsIdentity.DefaultRoleClaimType, role)));

//            var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_configuration["Jwt:Key"]));
//            var creds = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);

//            var token = new JwtSecurityToken(
//                _configuration["Jwt:Issuer"],
//                _configuration["Jwt:Issuer"],
//                claims,
//                expires: DateTime.Now.AddHours(1),
//                signingCredentials: creds);

//            return new JwtSecurityTokenHandler().WriteToken(token);
//        }
//    }
//}
